<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMate Terminal - AI-Powered Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }

        .terminal-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            color: #00d4ff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .header p {
            color: #a0a0a0;
            font-size: 1.1em;
        }

        .terminal {
            flex: 1;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }

        .terminal-output {
            margin-bottom: 20px;
        }

        .command-line {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .prompt {
            color: #00d4ff;
            margin-right: 10px;
            font-weight: bold;
        }

        .input-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }

        .input-prompt {
            color: #00d4ff;
            margin-right: 10px;
            font-weight: bold;
        }

        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #e0e0e0;
            font-family: inherit;
            font-size: inherit;
            outline: none;
            padding: 5px;
        }

        .ai-mode-toggle {
            margin-left: 10px;
            padding: 5px 10px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            border-radius: 5px;
            color: #00d4ff;
            cursor: pointer;
            font-size: 12px;
        }

        .ai-mode-toggle.active {
            background: #00d4ff;
            color: #0f0f23;
        }

        .ai-translation {
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid #00d4ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-style: italic;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #51cf66;
        }

        .info {
            color: #74c0fc;
        }

        .directory {
            color: #ffd43b;
        }

        .file {
            color: #e0e0e0;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .help-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .help-section h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .help-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .help-example {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #00d4ff;
        }

        .help-example h4 {
            color: #51cf66;
            margin-bottom: 8px;
        }

        .help-example code {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 3px;
            color: #ffd43b;
        }

        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #00d4ff rgba(255, 255, 255, 0.1);
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: #00b8e6;
        }
    </style>
</head>
<body>
    <div class="terminal-container">
        <div class="header">
            <h1>ü§ñ CodeMate Terminal</h1>
            <p>AI-Powered Terminal for macOS - Professional Edition</p>
        </div>

        <div class="terminal scrollbar" id="terminal">
            <div class="terminal-output">
                <div class="info">Welcome to CodeMate Terminal v2.0!</div>
                <div class="info">Type 'help' for available commands or use natural language.</div>
                <div class="info">Try AI commands like: "create a folder called test"</div>
                <br>
            </div>
        </div>

        <div class="input-container">
            <span class="input-prompt" id="prompt">user@codemate:~$</span>
            <input type="text" id="command-input" placeholder="Enter command or natural language..." autocomplete="off">
            <div class="ai-mode-toggle" id="ai-toggle">ü§ñ AI Mode</div>
        </div>

        <div class="help-section">
            <h3>üöÄ Quick Start Examples</h3>
            <div class="help-examples">
                <div class="help-example">
                    <h4>üìÅ File Operations</h4>
                    <div><code>ls</code> - List files</div>
                    <div><code>mkdir test</code> - Create folder</div>
                    <div><code>touch file.txt</code> - Create file</div>
                </div>
                <div class="help-example">
                    <h4>ü§ñ AI Commands</h4>
                    <div><code>"create a folder called demo"</code></div>
                    <div><code>"show me my files"</code></div>
                    <div><code>"what's my memory usage"</code></div>
                </div>
                <div class="help-example">
                    <h4>üîó Complex AI</h4>
                    <div><code>"create a new folder called test and move file1.txt into it"</code></div>
                    <div><code>"make a backup folder and copy all .py files to it"</code></div>
                </div>
                <div class="help-example">
                    <h4>üìä System Info</h4>
                    <div><code>ps</code> - Running processes</div>
                    <div><code>free</code> - Memory usage</div>
                    <div><code>system_info</code> - System details</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class CodeMateTerminal {
            constructor() {
                this.terminal = document.getElementById('terminal');
                this.input = document.getElementById('command-input');
                this.prompt = document.getElementById('prompt');
                this.aiToggle = document.getElementById('ai-toggle');
                this.aiMode = false;
                this.currentPath = '~';
                this.commandHistory = [];
                this.historyIndex = -1;

                this.init();
            }

            init() {
                this.input.addEventListener('keydown', (e) => this.handleKeyDown(e));
                this.aiToggle.addEventListener('click', () => this.toggleAIMode());
                this.input.focus();

                // Load initial help
                this.loadHelp();
            }

            toggleAIMode() {
                this.aiMode = !this.aiMode;
                this.aiToggle.classList.toggle('active', this.aiMode);
                this.input.placeholder = this.aiMode 
                    ? "Enter natural language command..." 
                    : "Enter command...";
            }

            handleKeyDown(e) {
                if (e.key === 'Enter') {
                    this.executeCommand();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    this.navigateHistory(-1);
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    this.navigateHistory(1);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    this.handleTabCompletion();
                }
            }

            navigateHistory(direction) {
                if (this.commandHistory.length === 0) return;

                this.historyIndex += direction;
                
                if (this.historyIndex < 0) {
                    this.historyIndex = 0;
                } else if (this.historyIndex >= this.commandHistory.length) {
                    this.historyIndex = this.commandHistory.length - 1;
                }

                this.input.value = this.commandHistory[this.historyIndex] || '';
            }

            async handleTabCompletion() {
                const command = this.input.value.trim();
                if (!command) return;

                // Simple tab completion for common commands
                const completions = {
                    'l': 'ls',
                    'p': 'pwd',
                    'c': 'cd',
                    'm': 'mkdir',
                    't': 'touch',
                    'h': 'help',
                    's': 'system_info',
                    'f': 'free',
                    'd': 'df',
                    'u': 'uptime'
                };

                for (const [prefix, full] of Object.entries(completions)) {
                    if (command === prefix) {
                        this.input.value = full + ' ';
                        break;
                    }
                }
            }

            async executeCommand() {
                const command = this.input.value.trim();
                if (!command) return;

                // Add to history
                this.commandHistory.push(command);
                this.historyIndex = this.commandHistory.length;

                // Display command
                this.addOutput(`<div class="command-line">
                    <span class="prompt">${this.prompt.textContent}</span>
                    <span>${this.escapeHtml(command)}</span>
                </div>`);

                // Show loading
                const loadingId = this.addOutput('<div class="loading"></div>');

                try {
                    const response = await fetch('/api/execute', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            command: command,
                            natural_language: this.aiMode
                        })
                    });

                    const result = await response.json();
                    
                    // Remove loading
                    this.removeOutput(loadingId);

                    if (result.status === 'success') {
                        // Show AI translation if available
                        if (result.ai_translation) {
                            this.addOutput(`<div class="ai-translation">
                                ü§ñ AI Translation: <code>${this.escapeHtml(result.ai_translation)}</code>
                            </div>`);
                        }

                        // Show output
                        if (result.output) {
                            const formattedOutput = this.formatOutput(result.output);
                            this.addOutput(`<div class="terminal-output">${formattedOutput}</div>`);
                        }

                        // Update prompt with current path
                        this.updatePrompt(result.current_path);

                        // Show error if any
                        if (result.error) {
                            this.addOutput(`<div class="error">Error: ${this.escapeHtml(result.error)}</div>`);
                        }
                    } else {
                        this.addOutput(`<div class="error">Error: ${this.escapeHtml(result.message)}</div>`);
                    }
                } catch (error) {
                    this.removeOutput(loadingId);
                    this.addOutput(`<div class="error">Connection error: ${this.escapeHtml(error.message)}</div>`);
                }

                // Clear input
                this.input.value = '';
                this.scrollToBottom();
            }

            async loadHelp() {
                try {
                    const response = await fetch('/api/help');
                    const result = await response.json();
                    
                    if (result.status === 'success') {
                        const formattedHelp = this.formatOutput(result.help);
                        this.addOutput(`<div class="terminal-output">${formattedHelp}</div>`);
                    }
                } catch (error) {
                    console.error('Failed to load help:', error);
                }
            }

            formatOutput(output) {
                if (!output) return '';

                return output
                    .replace(/\n/g, '<br>')
                    .replace(/üìÅ\s+/g, '<span class="directory">üìÅ </span>')
                    .replace(/üìÑ\s+/g, '<span class="file">üìÑ </span>')
                    .replace(/Error:/g, '<span class="error">Error:</span>')
                    .replace(/Success:/g, '<span class="success">Success:</span>')
                    .replace(/Warning:/g, '<span class="info">Warning:</span>');
            }

            updatePrompt(path) {
                const relativePath = path.replace(process.env.HOME || '/Users/user', '~');
                this.prompt.textContent = `user@codemate:${relativePath}$`;
            }

            addOutput(html) {
                const outputDiv = document.createElement('div');
                outputDiv.innerHTML = html;
                outputDiv.id = 'output-' + Date.now();
                this.terminal.appendChild(outputDiv);
                return outputDiv.id;
            }

            removeOutput(id) {
                const element = document.getElementById(id);
                if (element) {
                    element.remove();
                }
            }

            scrollToBottom() {
                this.terminal.scrollTop = this.terminal.scrollHeight;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize terminal when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new CodeMateTerminal();
        });
    </script>
</body>
</html>
